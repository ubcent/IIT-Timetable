Number.prototype.zeroPad=function(a){return a=a||2,(new Array(a).join("0")+this).slice(-1*a)},function(a){var b={init:function(b){b=a.extend({json:"[]",template_path:"views/table.mustache",partial_template_path:"views/event.mustache",time_range:[8,12]},b);var c=this;""==a.trim(b.json)&&(b.json="[]");var d=a.parseJSON(b.json);d.sort(function(a,b){var c=a.time.split(":",2),d=b.time.split(":",2);return c=60*parseInt(c[0])+parseInt(c[1]),d=60*parseInt(d[0])+parseInt(d[1]),d>c?-1:c>d?1:0}),a.get(b.template_path,function(e){a.get(b.partial_template_path,function(b){a(c).append(Mustache.render(e,{events:d},{event:b}))})})},add:function(b){b=a.extend({tsec:"08:00",dayw:"mo",partial_template_path:"views/event.mustache",template_path:"views/timeline.mustache"},b);var c=this;a.get(b.partial_template_path,function(d){a(c).find('[data-propname="time"]').length<1?a.get(b.template_path,function(e){b[b.dayw]=b,a(c).find('[data-root="true"]').append(Mustache.render(e,b,{event:d}))}):0==a(c).find('[data-time="'+b.tsec+'"]').length?(dif=24,this_time=parseInt(b.tsec.split(":")[0]),a.each(a(c).find('[data-propname="time"]'),function(b,c){_dif=parseInt(a(c).attr("data-time").split(":")[0])-this_time,Math.abs(_dif)<Math.abs(dif)&&(dif=_dif)}),a.get(b.template_path,function(e){b[b.dayw]=b,dif<0?a(c).find('[data-time="'+(this_time+dif).zeroPad()+':00"]').after(Mustache.render(e,b,{event:d})):a(c).find('[data-time="'+(this_time+dif).zeroPad()+':00"]').before(Mustache.render(e,b,{event:d}))})):a(c).find('[data-time="'+b.tsec+'"] [data-propname="'+b.dayw+'"]').append(Mustache.render(d,b))})},parse:function(b){b=a.extend({},b);var c=[];return a.each(a('.timetable [data-propname="time"]'),function(b,d){timeline={},timeline.time=a(d).attr("data-time"),a.each(a(d).children('[data-parent="true"]'),function(b,c){timeline[a(c).attr("data-propname")]=[],a.each(a(c).find('[data-parent="true"]'),function(b,d){props={},a.each(a(d).find('[data-save="true"]'),function(b,c){props[a(c).attr("data-propname")]=a(c).text()}),timeline[a(c).attr("data-propname")].push(props)})}),c.push(timeline)}),JSON.stringify(c)}};a.fn.jsonShedule=function(c){return b[c]?b[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof c&&c?void a.error("Метод с именем "+c+" не существует для jQuery.jsonShedule"):b.init.apply(this,arguments)}}(jQuery);